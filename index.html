<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLEDITOR Expert</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            background: #1e1e1e; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, sans-serif;
            overflow: hidden;
        }

        /* Barra de herramientas */
        .toolbar { 
            background: #2d2d2d; 
            padding: 10px 15px; 
            display: flex; 
            gap: 10px; 
            align-items: center; 
            border-bottom: 2px solid #444; 
        }

        button { 
            padding: 8px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: 0.2s;
        }

        .btn-blue { background: #007acc; color: white; }
        .btn-blue:hover { background: #005f9e; }
        .btn-red { background: #cc3300; color: white; }
        .btn-red:hover { background: #a32900; }
        
        #btn-download-app { 
            background: #28a745; 
            color: white; 
            display: none; /* Se activa por JS */
        }

        .status-tag { 
            margin-left: auto; 
            font-size: 11px; 
            color: #888; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        /* Contenedor principal */
        .main-container { 
            display: flex; 
            flex: 1; 
            overflow: hidden; 
        }

        textarea { 
            width: 50%; 
            background: #1a1a1a; 
            color: #9cdcfe; 
            font-family: 'Consolas', 'Monaco', monospace; 
            padding: 20px; 
            border: none; 
            outline: none; 
            resize: none; 
            font-size: 16px;
            border-right: 2px solid #333;
        }

        iframe { 
            width: 50%; 
            background: white; 
            border: none; 
        }

        #file-input { display: none; }
    </style>
</head>
<body>

<div class="toolbar">
    <button class="btn-blue" onclick="document.getElementById('file-input').click()">Importar</button>
    <input type="file" id="file-input" accept=".html">
    
    <button class="btn-blue" onclick="exportarHTML()">Guardar HTML</button>
    
    <button id="btn-download-app" onclick="alert('Descargando instalador... (Simulación)')">
        Descargar App Desktop
    </button>
    
    <button class="btn-red" onclick="limpiar()">Limpiar</button>
    
    <span id="status" class="status-tag">Iniciando...</span>
</div>

<div class="main-container">
    <textarea id="codigo" placeholder="Escribe tu código HTML/CSS aquí..."></textarea>
    <iframe id="preview"></iframe>
</div>

<script>
    const input = document.getElementById('codigo');
    const preview = document.getElementById('preview');
    const btnApp = document.getElementById('btn-download-app');
    const statusText = document.getElementById('status');

    // 1. Lógica de Detección de Modo App
    function detectarModo() {
        const urlParams = new URLSearchParams(window.location.search);
        const esModoApp = urlParams.get('mode') === 'app';

        if (esModoApp) {
            btnApp.style.display = 'none';
            statusText.innerText = "MODO APP";
            statusText.style.color = "#28a745";
        } else {
            btnApp.style.display = 'block';
            statusText.innerText = "MODO WEB";
        }
    }

    // 2. Actualización en tiempo real
    function update() {
        const doc = preview.contentDocument || preview.contentWindow.document;
        doc.open();
        doc.write(input.value);
        doc.close();
    }

    input.addEventListener('input', update);

    // 3. Importar Archivo
    document.getElementById('file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            input.value = e.target.result;
            update();
        };
        reader.readAsText(file);
    });

    // 4. Exportar / Guardar
    function exportarHTML() {
        const blob = new Blob([input.value], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'proyecto_experto.html';
        a.click();
    }

    // 5. Limpiar
    function limpiar() {
        if(confirm("¿Seguro que quieres borrar todo el código?")) {
            input.value = "";
            update();
        }
    }

    // Configuración Inicial
    window.onload = () => {
        detectarModo();
        input.value = "<h1>¡Hola desde HTMLEDITOR Expert!</h1>\n<p>Empieza a crear tu web aquí.</p>";
        update();
    };
</script>

</body>
</html>
