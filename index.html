<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLEDITOR Expert - Professional Edition</title>
    <style>
        /* Estilos Globales */
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            background: #1e1e1e; 
            color: #d4d4d4; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        /* Barra de Herramientas Superior */
        .toolbar { 
            background: #2d2d2d; 
            padding: 8px 15px; 
            display: flex; 
            gap: 12px; 
            align-items: center; 
            border-bottom: 1px solid #444; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 100;
        }

        button { 
            padding: 7px 14px; 
            border: none; 
            border-radius: 3px; 
            cursor: pointer; 
            font-size: 13px;
            font-weight: 600; 
            transition: all 0.2s ease;
        }

        .btn-blue { background: #007acc; color: white; }
        .btn-blue:hover { background: #005f9e; }
        .btn-red { background: #a33333; color: white; }
        .btn-red:hover { background: #822929; }
        
        /* Bot√≥n de Descarga Din√°mico */
        #btn-download-app { 
            background: #28a745; 
            color: white; 
            display: none; /* Controlado por JS */
        }
        #btn-download-app:hover { background: #218838; transform: translateY(-1px); }

        .status-badge { 
            margin-left: auto; 
            font-size: 10px; 
            padding: 3px 8px;
            border-radius: 10px;
            background: #3c3c3c;
            color: #aaa;
            text-transform: uppercase;
        }

        /* Contenedor del Editor */
        .main-content { display: flex; flex: 1; overflow: hidden; }

        .editor-container { 
            display: flex; 
            width: 50%; 
            background: #1e1e1e; 
            border-right: 1px solid #333;
            position: relative;
        }

        /* Contador de L√≠neas */
        .line-numbers { 
            width: 45px; 
            padding: 20px 0; 
            text-align: center; 
            background: #1e1e1e; 
            color: #858585; 
            font-family: 'Consolas', 'Courier New', monospace; 
            font-size: 14px; 
            line-height: 21px; /* Debe coincidir con el textarea */
            user-select: none;
            border-right: 1px solid #2d2d2d;
            overflow: hidden;
        }

        textarea { 
            flex: 1;
            background: transparent; 
            color: #9cdcfe; 
            font-family: 'Consolas', 'Courier New', monospace; 
            padding: 20px 10px; 
            border: none; 
            outline: none; 
            resize: none; 
            font-size: 14px;
            line-height: 21px;
            white-space: pre;
            overflow-x: auto;
            tab-size: 4;
        }

        /* Vista Previa */
        #preview-frame { 
            width: 50%; 
            background: white; 
            border: none; 
        }

        #file-input { display: none; }
    </style>
</head>
<body>

<div class="toolbar">
    <button class="btn-blue" onclick="document.getElementById('file-input').click()">üìÅ Importar</button>
    <input type="file" id="file-input" accept=".html">
    
    <button class="btn-blue" onclick="exportarHTML()">üíæ Guardar Archivo</button>
    
    <button id="btn-download-app" onclick="descargarApp()">
        üöÄ Instalar App Desktop
    </button>
    
    <button class="btn-red" onclick="limpiarEditor()">üóëÔ∏è Limpiar</button>
    
    <div id="status" class="status-badge">Detectando Entorno...</div>
</div>

<div class="main-content">
    <div class="editor-container">
        <div id="line-numbers" class="line-numbers">1</div>
        <textarea id="editor-input" spellcheck="false" placeholder=""></textarea>
    </div>
    <iframe id="preview-frame"></iframe>
</div>

<script>
    const editor = document.getElementById('editor-input');
    const preview = document.getElementById('preview-frame');
    const lines = document.getElementById('line-numbers');
    const btnApp = document.getElementById('btn-download-app');
    const status = document.getElementById('status');

    // 1. Detecci√≥n de Modo App mediante URL
    function inicializarEntorno() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('mode') === 'app') {
            btnApp.style.display = 'none';
            status.innerText = "Modo: Aplicaci√≥n Desktop";
            status.style.color = "#4ec9b0";
        } else {
            btnApp.style.display = 'block';
            status.innerText = "Modo: Web";
        }
    }

    // 2. L√≥gica del Contador de L√≠neas y Renderizado
    function render() {
        // Actualizar vista previa
        const doc = preview.contentDocument || preview.contentWindow.document;
        doc.open();
        doc.write(editor.value);
        doc.close();

        // Actualizar n√∫meros de l√≠nea
        const lineCount = editor.value.split('\n').length;
        let lineHTML = '';
        for (let i = 1; i <= lineCount; i++) {
            lineHTML += i + '<br>';
        }
        lines.innerHTML = lineHTML;
    }

    // Sincronizaci√≥n de Scroll
    editor.addEventListener('scroll', () => {
        lines.scrollTop = editor.scrollTop;
    });

    editor.addEventListener('input', render);

    // 3. Funci√≥n de Descarga del .exe
    function descargarApp() {
        // Se asume que el .exe est√° en la misma ra√≠z que el index.html
        const link = document.createElement('a');
        link.href = "HTMLEditorExpert.exe"; 
        link.download = "HTMLEditorExpert.exe";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // 4. Gesti√≥n de Archivos
    document.getElementById('file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            editor.value = e.target.result;
            render();
        };
        reader.readAsText(file);
    });

    function exportarHTML() {
        const blob = new Blob([editor.value], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mi_codigo_experto.html';
        a.click();
        URL.revokeObjectURL(url);
    }

    function limpiarEditor() {
        if(confirm("¬øEst√°s seguro de que deseas borrar todo el c√≥digo actual?")) {
            editor.value = "";
            render();
        }
    }

    // Carga Inicial
    window.onload = () => {
        inicializarEntorno();
        editor.value = "\n<h1 style='color: #007acc; font-family: sans-serif;'>¬°Listo para programar!</h1>\n<p>Prueba el contador de l√≠neas a la izquierda.</p>";
        render();
    };
</script>

</body>
</html>
