<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLEDITOR Expert</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            background: #1e1e1e; 
            color: white; 
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }

        /* Barra de herramientas */
        .toolbar { 
            background: #2d2d2d; 
            padding: 10px 15px; 
            display: flex; 
            gap: 10px; 
            align-items: center; 
            border-bottom: 2px solid #444; 
            z-index: 10;
        }

        button { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: #007acc; color: white; }
        .btn-red { background: #cc3300; color: white; }
        #btn-download-app { background: #28a745; color: white; display: none; }
        .status-tag { margin-left: auto; font-size: 11px; color: #888; }

        /* Estructura del Editor */
        .main-container { display: flex; flex: 1; overflow: hidden; }

        /* Contenedor del Editor con Contador */
        .editor-wrapper { 
            display: flex; 
            width: 50%; 
            background: #1a1a1a; 
            border-right: 2px solid #333;
            overflow: hidden;
        }

        /* Columna de números */
        .line-numbers { 
            width: 40px; 
            padding: 20px 5px; 
            text-align: right; 
            background: #1a1a1a; 
            color: #858585; 
            font-family: 'Consolas', monospace; 
            font-size: 16px; 
            line-height: 1.5; /* Debe ser igual al del textarea */
            user-select: none;
            overflow: hidden;
        }

        textarea { 
            flex: 1;
            background: transparent; 
            color: #9cdcfe; 
            font-family: 'Consolas', monospace; 
            padding: 20px 10px; 
            border: none; 
            outline: none; 
            resize: none; 
            font-size: 16px;
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
        }

        iframe { width: 50%; background: white; border: none; }
    </style>
</head>
<body>

<div class="toolbar">
    <button class="btn-blue" onclick="document.getElementById('file-input').click()">Importar</button>
    <input type="file" id="file-input" accept=".html">
    <button class="btn-blue" onclick="exportarHTML()">Guardar HTML</button>
    <button id="btn-download-app" onclick="alert('Descargando...')">Descargar App</button>
    <button class="btn-red" onclick="limpiar()">Limpiar</button>
    <span id="status" class="status-tag">MODO WEB</span>
</div>

<div class="main-container">
    <div class="editor-wrapper">
        <div id="line-numbers" class="line-numbers">1</div>
        <textarea id="codigo" spellcheck="false" placeholder="Escribe aquí..."></textarea>
    </div>
    <iframe id="preview"></iframe>
</div>

<script>
    const input = document.getElementById('codigo');
    const preview = document.getElementById('preview');
    const lineNumbers = document.getElementById('line-numbers');
    const btnApp = document.getElementById('btn-download-app');

    // 1. Detección de Modo App
    function detectarModo() {
        if (new URLSearchParams(window.location.search).get('mode') === 'app') {
            btnApp.style.display = 'none';
            document.getElementById('status').innerText = "MODO APP";
        } else {
            btnApp.style.display = 'block';
        }
    }

    // 2. Lógica del Contador de Líneas
    function updateLineNumbers() {
        const lines = input.value.split('\n').length;
        let lineNumbersHTML = '';
        for (let i = 1; i <= lines; i++) {
            lineNumbersHTML += i + '<br>';
        }
        lineNumbers.innerHTML = lineNumbersHTML;
    }

    // Sincronizar scroll entre el contador y el textarea
    input.addEventListener('scroll', () => {
        lineNumbers.scrollTop = input.scrollTop;
    });

    // 3. Actualización de Vista Previa
    function update() {
        const doc = preview.contentDocument || preview.contentWindow.document;
        doc.open();
        doc.write(input.value);
        doc.close();
        updateLineNumbers(); // Actualiza números al escribir
    }

    input.addEventListener('input', update);

    // 4. Funciones de Archivo
    function exportarHTML() {
        const blob = new Blob([input.value], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'proyecto.html';
        a.click();
    }

    function limpiar() {
        if(confirm("¿Borrar todo?")) {
            input.value = "";
            update();
        }
    }

    // Inicio
    window.onload = () => {
        detectarModo();
        input.value = "<h1>HTMLEDITOR Expert</h1>\n<p>Línea 2\nLínea 3</p>";
        update();
    };
</script>

</body>
</html>
